<!DOCTYPE html>
<html lang="en">
    <head>

        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-twilight.css"
            rel="stylesheet" />
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>

        <!-- Google tag (gtag.js) -->
        <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-QTXB9004Y4"></script>
        <script>


        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-QTXB9004Y4');
        </script>
        <!-- Metadata -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Zhehao Xu | Oasis Blitz</title>

        <link rel="stylesheet" href="../../../styles/home.css" />
        <link rel="stylesheet" href="../../../styles/sections.css" />
        <link rel="stylesheet" href="../../../styles/about.css" />
        <link rel="stylesheet" href="../../../styles/projects.css" />
        <link rel="stylesheet" href="../../../styles/profile.css" />
        <link rel="stylesheet" href="../../../styles/buttons.css" />
        <link rel="stylesheet" href="../../../styles/effects.css" />
        <link rel="stylesheet" href="../../../styles/scroll.css" />
        <link rel="stylesheet" href="../../../styles/skills.css" />
        <link rel="stylesheet" href="../../../styles/mediaqueries.css" />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

        <link rel="apple-touch-icon" sizes="180x180"
            href="../../icon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32"
            href="../../icon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16"
            href="../../icon/favicon-16x16.png">
        <link rel="manifest" href="../../icon/site.webmanifest">

        <script src="../../../scripts/main.js"></script>
        <script
            src="https://kit.fontawesome.com/31f4b01138.js"
            crossorigin="anonymous"></script>
    </head>
    <body>

        <nav id="desktop-nav">
            <div class="logo glow">
                <a class="logo-link" href="../../../index.html">.LOLXU</a>
            </div>
            <div>
                <ul class="nav-links">
                    <li><a href="../../../index.html#about">About</a></li>
                    <li><a href="../../../index.html#projects">Projects</a></li>
                    <li><a href="../../../index.html#skills">Skills</a></li>
                    <li><a href="../../../index.html#contact">Contact</a></li>
                </ul>
            </div>
        </nav>

        <nav id="small-nav">
            <div class="logo glow">
                <a class="logo-link" href="../../../index.html">.LOLXU</a>
            </div>
            <div class="small-menu">
                <div class="small-icon" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="menu-links">
                    <li><a href="../../../index.html#about"
                            onclick="toggleMenu()">About</a></li>
                    <li><a href="../../../index.html#projects"
                            onclick="toggleMenu()">Projects</a></li>
                    <li><a href="../../../index.html#skills"
                            onclick="toggleMenu()">Skills</a></li>
                    <li><a href="../../../index.html#contact"
                            onclick="toggleMenu()">Contact</a></li>
                </div>
            </div>
        </nav>

        <section class="project-page">
            <h1 class="title">Oasis Blitz</h1>
            <div class="project-shields">
                <img src="https://img.shields.io/badge/Engine-Unity-white"
                    alt="badge" />
                <img src="https://img.shields.io/badge/Language-C%23-green
                "
                    alt="badge" />
                <img src="https://img.shields.io/badge/Category-Game-red
                "
                    alt="badge" />
                <img
                    src="https://img.shields.io/badge/Type-Group%20project%20-purple"
                    alt="badge" />
            </div>
            <div class="article-container">
                <video autoplay muted loop playsinline
                    class="project-thumbnail-vid">
                    <source src="../../videos/agp.mp4"
                        type="video/mp4">
                </video>
            </div>
            <div class="btn-container project-btn-container">
                <button class="btn btn-color-2"
                    onclick="window.open('https://github.com/lolxu/AGPCode')">
                    GitHub
                </button>
                <button class="btn btn-color-2"
                    onclick="window.open('https://teamblitz.itch.io/oasis-blitz')">
                    Itch.io
                </button>
            </div>
            <div class="section__text">
                <p class="project-description-details">
                    Oasis Blitz is a unique platforming game that has drilling
                    as the main mechanic. You can drill into the terrain, hop
                    out, drill into enemies, and there are plenty of interesting
                    challenges for you to overcome.
                    <br /><br />
                    I am a gameplay / tools engineer on the team, and i have
                    worked on several different areas. I have implemented a
                    <mark>save and load system using XML</mark>, a
                    <mark>checkpoint system</mark>,
                    <mark>gameplay animation using Animancer</mark>,
                    <mark>automated targeting for the grapple mechanic</mark>,
                    <mark>enemy mechanics</mark>,
                    <mark>Optimization through object pooling</mark>, and
                    <mark>a cinematics tool inside Unity using Cinemachine and
                        splines</mark>.
                    <br /><br />
                    I also worked with <mark>hiearchical state machine</mark>
                    for enemy and
                    player
                    movement mechanics. Using hiearchical statemachine helped
                    all engineers on the team to structure their code according
                    to a specified style, and implementing new player / enemy
                    behaviors become a lot simpler.
                    We are also leveraging available
                    powerful Unity packages like FMOD, DOTween, and FEEL to
                    facilitate the
                    development of our game.
                </p>

                <div style="margin-top: 20px; text-align:left;">
                    <h2>Code Snippets</h2>
                    <p>Here's my code for a custom object pooler class</p>
                    <pre style="width:auto; height:500px; overflow: scroll;">
                    <code class="language-clike">
public class ObjectPooler : MonoBehaviour
{
    [System.Serializable]
    public class Pool
    {
        public String tag;
        public GameObject prefab;
        public int size;
    }

    public List<Pool> pools;
    public Dictionary<String, List<GameObject>> poolDictionary;
    
#region Singleton
    public static ObjectPooler Instance;
    private void Awake()
    {
        Instance = this;
    }
#endregion
    
    private void Start()
    {
        poolDictionary = new Dictionary<string, List<GameObject>>();

        foreach (Pool pool in pools)
        {
            List<GameObject> objectPool = new List<GameObject>();

            for (int i = 0; i < pool.size; i++)
            {
                GameObject obj = Instantiate(pool.prefab, transform);
                obj.SetActive(false);
                objectPool.Add(obj);
            }
            poolDictionary.Add(pool.tag, objectPool);
        }
    }

    /// <summary>
    /// Function to allocate gameobjects from the pool
    /// </summary>
    /// <param name="tag"> The type of gameobject </param>
    /// <param name="pos"> The position to spawn the object </param>
    /// <param name="rotation"> The rotation to spawn the object </param>
    /// <returns></returns>
    public GameObject Allocate(String tag, Vector3 pos, Quaternion rotation)
    {
        if (!poolDictionary.ContainsKey(tag))
        {
            Debug.LogError("Pool with tag " + tag + " does not exist");
            return null;
        }

        GameObject objToSpawn = null;

        foreach (var obj in poolDictionary[tag])
        {
            if (!obj.activeInHierarchy)
            {
                objToSpawn = obj;
                break;
            }
        }

        if (objToSpawn != null)
        {
            objToSpawn.SetActive(true);
            // objToSpawn.transform.SetParent(null);
            objToSpawn.transform.position = pos;
            objToSpawn.transform.rotation = rotation;

            IPooledObject pooledObj = objToSpawn.GetComponent<IPooledObject>();
            if (pooledObj != null)
            {
                pooledObj.OnObjectAllocate();
            }
        }
        return objToSpawn;
    }

    /// <summary>
    /// Function to Deallocate gameobjects from the pool.
    /// </summary>
    /// <param name="tag"> The type of gameobject </param>
    /// <param name="deallocateObject"> The gameobject to deallocate </param>
    public void Deallocate(String tag, GameObject deallocateObject)
    {
        if (!poolDictionary.ContainsKey(tag))
        {
            Debug.LogError("Pool with tag " + tag + " does not exist");
            return;
        }
        IPooledObject pooledObj = deallocateObject.GetComponent<IPooledObject>();
        if (pooledObj != null)
        {
            pooledObj.OnObjectDeallocate();
        }
        deallocateObject.SetActive(false); 
    }

    /// <summary>
    /// Deallocate all objects associated with the tag.
    /// </summary>
    /// <param name="tag"> The type of gameobject </param>
    public void DeallocateAll(String tag)
    {
        if (!poolDictionary.ContainsKey(tag))
        {
            Debug.LogError("Pool with tag " + tag + " does not exist");
            return;
        }
    }
}
                    </code>
                    </pre>
                    <p>Here's some code for my automated targeting system</p>
                    <pre style="width:auto; height:500px; overflow: scroll;">
                        <code class="language-clike">
private void CheckForTargets()
{
    GameObject currentBestTarget = null;
    
    // Checking for overlapping colliders for auto aim
    Collider[] results = new Collider[m_maxColliders];
    int numCol = Physics.OverlapSphereNonAlloc(transform.position, m_autoAimRadius, results, m_aimMask);
    
    List<GameObject> inRangeGameObjects = new List<GameObject>();
    for (int i = 0; i < numCol; i++)
    {
        inRangeGameObjects.Add(results[i].gameObject);
    }

    // Sort the list based on distance to player
    inRangeGameObjects = inRangeGameObjects
        .OrderBy(obj => Vector3.Distance(Camera.main.transform.position, obj.transform.position))
        .ToList();
    
    // Debug.Log(inRangeGameObjects[0]);

    bool foundTarget = false;
    float bestAngle = Single.MaxValue;
    for (int i = 0; i < inRangeGameObjects.Count; i++)
    {
        GameObject curObj = inRangeGameObjects[i];
        Vector3 fromMeToObj = (curObj.transform.position - Camera.main.transform.position).normalized;
        float angle = Mathf.Acos(Vector3.Dot(Camera.main.transform.forward, fromMeToObj)) * Mathf.Rad2Deg;
        
        if (angle <= m_autoAimAngle)
        {
            // Check if raycast is actually hitting the desired game object
            RaycastHit hit;
            
            bool checkHit = Physics.Raycast(Camera.main.transform.position, fromMeToObj, out hit, m_autoAimRadius, ~m_ignoreMasks);
            
            if (checkHit && hit.collider.gameObject.layer == 6 && hit.collider.gameObject == curObj)
            {
                if (bestAngle > angle)
                {
                    bestAngle = angle;
                    currentBestTarget = curObj;
                }
                foundTarget = true;
            }
        }
    }

    if (currentBestTarget != null && currentBestTarget != m_targetObject)
    {
        m_targetObject = currentBestTarget;
    }
    else if (m_targetObject == null || !foundTarget)
    {
        m_targetObject = null;
    }

    m_reticle.m_target = m_targetObject;
}
                        </code>
                        </pre>
                    <p>Here's how we approached the Hiearchical
                        Statemachine</p>
                    <pre style="width:auto; height:500px; overflow: scroll;">
                            <code class="language-clike">
// Inside PlayerStateFactory.cs
// PlayerStates are enums for all the different states
public enum PlayerStates
{
    Idle,
    Walk,
    Slide,
    RestrictedHorizontalMovement,
    Drill,
    DrillAbove,
    DrillBelow,
    Dash,
    FreeFall,
    Grounded,
    Dead,
    Ball
}

public class PlayerStateFactory
{
    PlayerStateMachine context;
    // Stored all states with dictionary for ease of access
    public Dictionary<PlayerStates, BaseState> states = new Dictionary<PlayerStates, BaseState>();

    public PlayerStateFactory(PlayerStateMachine currentContext)
    {
        // All states are initialized
        context = currentContext;
        states[PlayerStates.Idle] = new IdleState(context, this);
        states[PlayerStates.Walk] = new WalkState(context, this);
        states[PlayerStates.Slide] = new SlideState(context, this);
        states[PlayerStates.RestrictedHorizontalMovement] = new RestrictedHorizontalMovementState(context, this);
        states[PlayerStates.Drill] = new DrillState(context, this);
        states[PlayerStates.DrillAbove] = new DrillAboveState(context, this);
        states[PlayerStates.DrillBelow] = new DrillBelowState(context, this);
        states[PlayerStates.Dash] = new DashState(context, this);
        states[PlayerStates.FreeFall] = new FreeFallState(context, this);
        states[PlayerStates.Grounded] = new GroundedState(context, this);
        states[PlayerStates.Dead] = new DeadState(context, this);
        states[PlayerStates.Ball] = new BallState(context, this);
    }
    // Other code below...

// We have base states as abstract classes
public abstract class BaseState
{
    public abstract void EnterState();
    public abstract void UpdateState();
    public abstract void ExitState();
    public abstract void CheckSwitchStates();
    public abstract void InitializeSubState();
    public abstract string StateName();
}

// We can implement hiearchical states through inheritance
// We divide states into root states and substates
// Here's a demonstration of substate implementation
public class DrillAboveState : BaseState
{
    public DrillAboveState(PlayerStateMachine currentContext, PlayerStateFactory playerStateFactory) : base(currentContext, playerStateFactory)
    {
        StateEnum = PlayerStates.DrillAbove;
    }

    public override void EnterState()
    {
        Ctx.PlayerPhysics.CurrentGravityMode = PlayerPhysics.GravityMode.DrillAbove;
        Ctx.PlayerPhysics.CurrentDragMode = PlayerPhysics.DragMode.DrillAbove;
        Ctx.PlayerPhysics.CurrentInputMode = PlayerPhysics.InputMode.Airborne;
    }
    // Other stuff like this...
                            </code>
                            </pre>
                </div>
            </div>
            <div class="btn-container project-btn-container">
                <button class="btn btn-color-2"
                    onclick="window.location.href='../../../#projects'">
                    Back
                </button>
            </div>
        </section>
        <footer>
            <nav>
                <div class="nav-links-container">
                    <ul class="nav-links">
                        <li><a href="../../../#about">About</a></li>
                        <li><a href="../../../#projects">Projects</a></li>
                        <li><a href="../../../#skills">Skills</a></li>
                        <li><a href="../../../#contact">Contact</a></li>
                    </ul>
                </div>
            </nav>
            <p>Copyright &#169; 2024 Zhehao Xu. All Rights Reserved.</p>
        </footer>
    </body>

</html>